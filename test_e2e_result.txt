2025-10-21 13:56:54 [info     ] Task database initialized      db_path=tasks.db
2025-10-21 13:56:54,431 - src.core.centralized_logging - INFO - centralized_logging:setup_logging:403 - Logging system initialized with level=INFO, format=json
2025-10-21 13:56:54,464 - src.core.advanced_security_system - INFO - advanced_security_system:__init__:87 - Advanced security system initialized
2025-10-21 13:56:54,466 - src.core.advanced_ensemble_optimizer - INFO - advanced_ensemble_optimizer:__init__:140 - Advanced ensemble optimizer initialized with learning=True
2025-10-21 13:56:54,466 - src.core.unified_explanation_engine - INFO - unified_explanation_engine:__init__:214 - Unified explanation engine initialized with caching=True
2025-10-21 13:56:54,466 - src.core.multi_tier_cache - INFO - multi_tier_cache:__init__:149 - Multi-tier cache system initialized: L1=100MB, L2=False, L3=True, Policy=lru
2025-10-21 13:56:54,468 - src.core.advanced_security_system - INFO - advanced_security_system:__init__:87 - Advanced security system initialized
2025-10-21 13:56:54,468 - src.core.unified_ml_system - INFO - unified_ml_system:__init__:266 - Unified ML system initialized with dependency injection
2025-10-21 13:56:54 [info     ] Enhanced WorkerManager initialized max_queue_size=50 max_workers=2
2025-10-21 13:56:54,624 - src.api.middleware.security_middleware - INFO - security_middleware:setup_security_middleware:248 - Security middleware setup completed
2025-10-21 13:56:54,624 - src.core.enhanced_config - INFO - enhanced_config:load_settings:238 - Configuration loaded successfully for environment: testing
2025-10-21 13:56:54,624 - src.core.enhanced_logging - INFO - Enhanced logging system initialized
2025-10-21 13:56:54,699 - root - INFO - EHR Integration API enabled
2025-10-21 13:56:54,699 - src.core.plugin_system - INFO - Plugin manager initialized
2025-10-21 13:56:54,708 - src.core.plugin_system - INFO - Plugin manager initialized
2025-10-21 13:56:54,714 - root - INFO - Plugin Management API enabled
============================= test session starts =============================
platform win32 -- Python 3.11.9, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\kevin\Desktop\ElectroAnalyzer\venv_test\Scripts\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\kevin\Desktop\ElectroAnalyzer
configfile: pytest.ini
plugins: anyio-4.11.0, asyncio-0.25.0, cov-6.0.0, mock-3.14.0, xdist-3.6.0
asyncio: mode=Mode.AUTO, asyncio_default_fixture_loop_scope=None
collecting ... collected 1 item

tests/e2e/test_document_analysis_workflow.py::TestDocumentAnalysisWorkflow::test_complete_analysis_workflow 2025-10-21 13:56:54,893 - src.api.middleware.performance_monitoring - INFO - Performance monitoring middleware initialized
2025-10-21 13:56:54,893 - logging_setup - INFO - {"event": "Structured logging configured successfully.", "logger": "logging_setup", "level": "info", "timestamp": "2025-10-21T20:56:54.893188Z"}
{"event": "Structured logging configured successfully.", "logger": "logging_setup", "level": "info", "timestamp": "2025-10-21T20:56:54.893188Z"}
2025-10-21 13:56:54,893 - src.database.database - INFO - Initializing database schema
Initializing database schema
2025-10-21 13:56:54,901 - src.database.database - INFO - Applying SQLite performance optimizations
Applying SQLite performance optimizations
2025-10-21 13:56:54,907 - src.database.database - INFO - Database initialization complete
Database initialization complete
2025-10-21 13:56:54,907 - src.api.dependencies - INFO - Application starting up...
Application starting up...
2025-10-21 13:56:54,907 - src.api.dependencies - INFO - Initializing real AnalysisService.
Initializing real AnalysisService.
2025-10-21 13:56:54,907 - src.api.dependencies - INFO - Retriever instance not found, creating a new one.
Retriever instance not found, creating a new one.
2025-10-21 13:56:54,914 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
Use pytorch device_name: cpu
2025-10-21 13:56:54,915 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: pritamdeka/S-PubMedBert-MS-MARCO
Load pretrained SentenceTransformer: pritamdeka/S-PubMedBert-MS-MARCO
2025-10-21 13:56:57,471 - src.core.query_expander - INFO - Initialized default medical vocabulary
Initialized default medical vocabulary
2025-10-21 13:56:57,471 - src.api.dependencies - INFO - New retriever instance created and initialized.
New retriever instance created and initialized.
2025-10-21 13:56:57,471 - src.core.analysis_service - INFO - AnalysisService initialized with use_mocks=False
AnalysisService initialized with use_mocks=False
2025-10-21 13:56:57,480 - presidio-analyzer - INFO - nlp_engine not provided, creating default.
nlp_engine not provided, creating default.
2025-10-21 13:56:58,897 - presidio-analyzer - INFO - Created NLP engine: spacy. Loaded models: ['en']
Created NLP engine: spacy. Loaded models: ['en']
2025-10-21 13:56:59,177 - presidio-analyzer - INFO - Loaded recognizer: CreditCardRecognizer
Loaded recognizer: CreditCardRecognizer
2025-10-21 13:56:59,177 - presidio-analyzer - INFO - Loaded recognizer: CreditCardRecognizer
Loaded recognizer: CreditCardRecognizer
2025-10-21 13:56:59,177 - presidio-analyzer - INFO - Loaded recognizer: CreditCardRecognizer
Loaded recognizer: CreditCardRecognizer
2025-10-21 13:56:59,177 - presidio-analyzer - INFO - Loaded recognizer: CreditCardRecognizer
Loaded recognizer: CreditCardRecognizer
2025-10-21 13:56:59,177 - presidio-analyzer - INFO - Loaded recognizer: UsBankRecognizer
Loaded recognizer: UsBankRecognizer
2025-10-21 13:56:59,177 - presidio-analyzer - INFO - Loaded recognizer: UsLicenseRecognizer
Loaded recognizer: UsLicenseRecognizer
2025-10-21 13:56:59,177 - presidio-analyzer - INFO - Loaded recognizer: UsItinRecognizer
Loaded recognizer: UsItinRecognizer
2025-10-21 13:56:59,177 - presidio-analyzer - INFO - Loaded recognizer: UsPassportRecognizer
Loaded recognizer: UsPassportRecognizer
2025-10-21 13:56:59,177 - presidio-analyzer - INFO - Loaded recognizer: UsSsnRecognizer
Loaded recognizer: UsSsnRecognizer
2025-10-21 13:56:59,177 - presidio-analyzer - INFO - Loaded recognizer: NhsRecognizer
Loaded recognizer: NhsRecognizer
2025-10-21 13:56:59,177 - presidio-analyzer - INFO - Loaded recognizer: SgFinRecognizer
Loaded recognizer: SgFinRecognizer
2025-10-21 13:56:59,181 - presidio-analyzer - INFO - Loaded recognizer: AuAbnRecognizer
Loaded recognizer: AuAbnRecognizer
2025-10-21 13:56:59,181 - presidio-analyzer - INFO - Loaded recognizer: AuAcnRecognizer
Loaded recognizer: AuAcnRecognizer
2025-10-21 13:56:59,181 - presidio-analyzer - INFO - Loaded recognizer: AuTfnRecognizer
Loaded recognizer: AuTfnRecognizer
2025-10-21 13:56:59,181 - presidio-analyzer - INFO - Loaded recognizer: AuMedicareRecognizer
Loaded recognizer: AuMedicareRecognizer
2025-10-21 13:56:59,181 - presidio-analyzer - INFO - Loaded recognizer: InPanRecognizer
Loaded recognizer: InPanRecognizer
2025-10-21 13:56:59,181 - presidio-analyzer - INFO - Loaded recognizer: InAadhaarRecognizer
Loaded recognizer: InAadhaarRecognizer
2025-10-21 13:56:59,181 - presidio-analyzer - INFO - Loaded recognizer: InVehicleRegistrationRecognizer
Loaded recognizer: InVehicleRegistrationRecognizer
2025-10-21 13:56:59,181 - presidio-analyzer - INFO - Loaded recognizer: InPassportRecognizer
Loaded recognizer: InPassportRecognizer
2025-10-21 13:56:59,181 - presidio-analyzer - INFO - Loaded recognizer: EsNifRecognizer
Loaded recognizer: EsNifRecognizer
2025-10-21 13:56:59,181 - presidio-analyzer - INFO - Loaded recognizer: EsNieRecognizer
Loaded recognizer: EsNieRecognizer
2025-10-21 13:56:59,181 - presidio-analyzer - INFO - Loaded recognizer: ItDriverLicenseRecognizer
Loaded recognizer: ItDriverLicenseRecognizer
2025-10-21 13:56:59,185 - presidio-analyzer - INFO - Loaded recognizer: ItFiscalCodeRecognizer
Loaded recognizer: ItFiscalCodeRecognizer
2025-10-21 13:56:59,185 - presidio-analyzer - INFO - Loaded recognizer: ItVatCodeRecognizer
Loaded recognizer: ItVatCodeRecognizer
2025-10-21 13:56:59,185 - presidio-analyzer - INFO - Loaded recognizer: ItIdentityCardRecognizer
Loaded recognizer: ItIdentityCardRecognizer
2025-10-21 13:56:59,185 - presidio-analyzer - INFO - Loaded recognizer: ItPassportRecognizer
Loaded recognizer: ItPassportRecognizer
2025-10-21 13:56:59,185 - presidio-analyzer - INFO - Loaded recognizer: PlPeselRecognizer
Loaded recognizer: PlPeselRecognizer
2025-10-21 13:56:59,185 - presidio-analyzer - INFO - Loaded recognizer: CryptoRecognizer
Loaded recognizer: CryptoRecognizer
2025-10-21 13:56:59,185 - presidio-analyzer - INFO - Loaded recognizer: DateRecognizer
Loaded recognizer: DateRecognizer
2025-10-21 13:56:59,185 - presidio-analyzer - INFO - Loaded recognizer: EmailRecognizer
Loaded recognizer: EmailRecognizer
2025-10-21 13:56:59,185 - presidio-analyzer - INFO - Loaded recognizer: IbanRecognizer
Loaded recognizer: IbanRecognizer
2025-10-21 13:56:59,185 - presidio-analyzer - INFO - Loaded recognizer: IpRecognizer
Loaded recognizer: IpRecognizer
2025-10-21 13:56:59,185 - presidio-analyzer - INFO - Loaded recognizer: MedicalLicenseRecognizer
Loaded recognizer: MedicalLicenseRecognizer
2025-10-21 13:56:59,185 - presidio-analyzer - INFO - Loaded recognizer: PhoneRecognizer
Loaded recognizer: PhoneRecognizer
2025-10-21 13:56:59,185 - presidio-analyzer - INFO - Loaded recognizer: UrlRecognizer
Loaded recognizer: UrlRecognizer
2025-10-21 13:56:59,185 - presidio-analyzer - INFO - Loaded recognizer: InVoterRecognizer
Loaded recognizer: InVoterRecognizer
2025-10-21 13:56:59,185 - presidio-analyzer - WARNING - Recognizer not added to registry because language is not supported by registry - CreditCardRecognizer supported languages: es, registry supported languages: en
Recognizer not added to registry because language is not supported by registry - CreditCardRecognizer supported languages: es, registry supported languages: en
2025-10-21 13:56:59,185 - presidio-analyzer - WARNING - Recognizer not added to registry because language is not supported by registry - CreditCardRecognizer supported languages: it, registry supported languages: en
Recognizer not added to registry because language is not supported by registry - CreditCardRecognizer supported languages: it, registry supported languages: en
2025-10-21 13:56:59,185 - presidio-analyzer - WARNING - Recognizer not added to registry because language is not supported by registry - CreditCardRecognizer supported languages: pl, registry supported languages: en
Recognizer not added to registry because language is not supported by registry - CreditCardRecognizer supported languages: pl, registry supported languages: en
2025-10-21 13:56:59,190 - presidio-analyzer - WARNING - Recognizer not added to registry because language is not supported by registry - EsNifRecognizer supported languages: es, registry supported languages: en
Recognizer not added to registry because language is not supported by registry - EsNifRecognizer supported languages: es, registry supported languages: en
2025-10-21 13:56:59,190 - presidio-analyzer - WARNING - Recognizer not added to registry because language is not supported by registry - EsNieRecognizer supported languages: es, registry supported languages: en
Recognizer not added to registry because language is not supported by registry - EsNieRecognizer supported languages: es, registry supported languages: en
2025-10-21 13:56:59,190 - presidio-analyzer - WARNING - Recognizer not added to registry because language is not supported by registry - ItDriverLicenseRecognizer supported languages: it, registry supported languages: en
Recognizer not added to registry because language is not supported by registry - ItDriverLicenseRecognizer supported languages: it, registry supported languages: en
2025-10-21 13:56:59,190 - presidio-analyzer - WARNING - Recognizer not added to registry because language is not supported by registry - ItFiscalCodeRecognizer supported languages: it, registry supported languages: en
Recognizer not added to registry because language is not supported by registry - ItFiscalCodeRecognizer supported languages: it, registry supported languages: en
2025-10-21 13:56:59,190 - presidio-analyzer - WARNING - Recognizer not added to registry because language is not supported by registry - ItVatCodeRecognizer supported languages: it, registry supported languages: en
Recognizer not added to registry because language is not supported by registry - ItVatCodeRecognizer supported languages: it, registry supported languages: en
2025-10-21 13:56:59,190 - presidio-analyzer - WARNING - Recognizer not added to registry because language is not supported by registry - ItIdentityCardRecognizer supported languages: it, registry supported languages: en
Recognizer not added to registry because language is not supported by registry - ItIdentityCardRecognizer supported languages: it, registry supported languages: en
2025-10-21 13:56:59,190 - presidio-analyzer - WARNING - Recognizer not added to registry because language is not supported by registry - ItPassportRecognizer supported languages: it, registry supported languages: en
Recognizer not added to registry because language is not supported by registry - ItPassportRecognizer supported languages: it, registry supported languages: en
2025-10-21 13:56:59,190 - presidio-analyzer - WARNING - Recognizer not added to registry because language is not supported by registry - PlPeselRecognizer supported languages: pl, registry supported languages: en
Recognizer not added to registry because language is not supported by registry - PlPeselRecognizer supported languages: pl, registry supported languages: en
2025-10-21 13:56:59,190 - presidio-analyzer - INFO - Loaded recognizer: SpacyRecognizer
Loaded recognizer: SpacyRecognizer
2025-10-21 13:56:59,304 - src.core.preprocessing_service - INFO - Successfully loaded custom medical dictionary from: src/resources/medical_dictionary.txt
Successfully loaded custom medical dictionary from: src/resources/medical_dictionary.txt
2025-10-21 13:56:59,312 - src.core.unified_explanation_engine - INFO - Unified explanation engine initialized with caching=True
Unified explanation engine initialized with caching=True
2025-10-21 13:56:59,312 - src.core.advanced_ensemble_optimizer - INFO - Advanced ensemble optimizer initialized with learning=True
Advanced ensemble optimizer initialized with learning=True
2025-10-21 13:56:59,312 - src.core.human_feedback_system - INFO - Human feedback system initialized with learning=True
Human feedback system initialized with learning=True
2025-10-21 13:56:59,314 - src.core.accuracy_hallucination_tracker - INFO - AccuracyHallucinationTracker initialized with tracking enabled: True
AccuracyHallucinationTracker initialized with tracking enabled: True
2025-10-21 13:56:59,321 - src.core.safe_accuracy_improvements - INFO - SafeAccuracyEnhancer initialized with 10 strategies
SafeAccuracyEnhancer initialized with 10 strategies
2025-10-21 13:56:59,321 - src.core.multi_tier_cache - INFO - Multi-tier cache system initialized: L1=200MB, L2=False, L3=True, Policy=lru
Multi-tier cache system initialized: L1=200MB, L2=False, L3=True, Policy=lru
2025-10-21 13:56:59,321 - src.core.clinical_education_engine - INFO - Clinical education engine initialized with 5 learning objectives and 5 content items
Clinical education engine initialized with 5 learning objectives and 5 content items
2025-10-21 13:56:59,321 - src.core.analysis_service - INFO - 7 Habits Framework initialized successfully
7 Habits Framework initialized successfully
2025-10-21 13:56:59,329 - src.core.rag_database_integration - INFO - RAG database initialized successfully
RAG database initialized successfully
2025-10-21 13:56:59,329 - src.core.analysis_service - INFO - RAG system initialized successfully
RAG system initialized successfully
2025-10-21 13:56:59,331 - src.core.model_selection_utils - INFO - Selected generator profile cpu_tinyllama_clinical (system memory {mem_gb} GB)
Selected generator profile cpu_tinyllama_clinical (system memory {mem_gb} GB)
2025-10-21 13:56:59,331 - src.core.model_selection_utils - WARNING - Configured generator_local_path does not exist: C:\Users\kevin\Desktop\ElectroAnalyzer\models\tinyllama-clinical
Configured generator_local_path does not exist: C:\Users\kevin\Desktop\ElectroAnalyzer\models\tinyllama-clinical
2025-10-21 13:56:59,331 - src.core.ner - INFO - Loading clinical NER model: OpenMed/OpenMed-NER-PathologyDetect-PubMed-v2-109M
Loading clinical NER model: OpenMed/OpenMed-NER-PathologyDetect-PubMed-v2-109M
2025-10-21 13:56:59,878 - src.core.ner - INFO - Successfully loaded clinical NER model: OpenMed/OpenMed-NER-PathologyDetect-PubMed-v2-109M
Device set to use cpu
Successfully loaded clinical NER model: OpenMed/OpenMed-NER-PathologyDetect-PubMed-v2-109M
2025-10-21 13:56:59,878 - src.core.ner - INFO - Loading clinical NER model: d4data/biomedical-ner-all
Loading clinical NER model: d4data/biomedical-ner-all
Device set to use cpu
2025-10-21 13:57:00,260 - src.core.ner - INFO - Successfully loaded clinical NER model: d4data/biomedical-ner-all
Successfully loaded clinical NER model: d4data/biomedical-ner-all
2025-10-21 13:57:00,260 - presidio-analyzer - INFO - nlp_engine not provided, creating default.
nlp_engine not provided, creating default.
2025-10-21 13:57:01,608 - presidio-analyzer - INFO - Created NLP engine: spacy. Loaded models: ['en']
Created NLP engine: spacy. Loaded models: ['en']
2025-10-21 13:57:01,608 - presidio-analyzer - INFO - registry not provided, creating default.
registry not provided, creating default.
2025-10-21 13:57:01,617 - presidio-analyzer - INFO - Loaded recognizer: CreditCardRecognizer
Loaded recognizer: CreditCardRecognizer
2025-10-21 13:57:01,617 - presidio-analyzer - INFO - Loaded recognizer: CreditCardRecognizer
Loaded recognizer: CreditCardRecognizer
2025-10-21 13:57:01,617 - presidio-analyzer - INFO - Loaded recognizer: CreditCardRecognizer
Loaded recognizer: CreditCardRecognizer
2025-10-21 13:57:01,617 - presidio-analyzer - INFO - Loaded recognizer: CreditCardRecognizer
Loaded recognizer: CreditCardRecognizer
2025-10-21 13:57:01,617 - presidio-analyzer - INFO - Loaded recognizer: UsBankRecognizer
Loaded recognizer: UsBankRecognizer
2025-10-21 13:57:01,617 - presidio-analyzer - INFO - Loaded recognizer: UsLicenseRecognizer
Loaded recognizer: UsLicenseRecognizer
2025-10-21 13:57:01,617 - presidio-analyzer - INFO - Loaded recognizer: UsItinRecognizer
Loaded recognizer: UsItinRecognizer
2025-10-21 13:57:01,617 - presidio-analyzer - INFO - Loaded recognizer: UsPassportRecognizer
Loaded recognizer: UsPassportRecognizer
2025-10-21 13:57:01,617 - presidio-analyzer - INFO - Loaded recognizer: UsSsnRecognizer
Loaded recognizer: UsSsnRecognizer
2025-10-21 13:57:01,617 - presidio-analyzer - INFO - Loaded recognizer: NhsRecognizer
Loaded recognizer: NhsRecognizer
2025-10-21 13:57:01,617 - presidio-analyzer - INFO - Loaded recognizer: SgFinRecognizer
Loaded recognizer: SgFinRecognizer
2025-10-21 13:57:01,617 - presidio-analyzer - INFO - Loaded recognizer: AuAbnRecognizer
Loaded recognizer: AuAbnRecognizer
2025-10-21 13:57:01,617 - presidio-analyzer - INFO - Loaded recognizer: AuAcnRecognizer
Loaded recognizer: AuAcnRecognizer
2025-10-21 13:57:01,617 - presidio-analyzer - INFO - Loaded recognizer: AuTfnRecognizer
Loaded recognizer: AuTfnRecognizer
2025-10-21 13:57:01,617 - presidio-analyzer - INFO - Loaded recognizer: AuMedicareRecognizer
Loaded recognizer: AuMedicareRecognizer
2025-10-21 13:57:01,617 - presidio-analyzer - INFO - Loaded recognizer: InPanRecognizer
Loaded recognizer: InPanRecognizer
2025-10-21 13:57:01,617 - presidio-analyzer - INFO - Loaded recognizer: InAadhaarRecognizer
Loaded recognizer: InAadhaarRecognizer
2025-10-21 13:57:01,617 - presidio-analyzer - INFO - Loaded recognizer: InVehicleRegistrationRecognizer
Loaded recognizer: InVehicleRegistrationRecognizer
2025-10-21 13:57:01,617 - presidio-analyzer - INFO - Loaded recognizer: InPassportRecognizer
Loaded recognizer: InPassportRecognizer
2025-10-21 13:57:01,617 - presidio-analyzer - INFO - Loaded recognizer: EsNifRecognizer
Loaded recognizer: EsNifRecognizer
2025-10-21 13:57:01,625 - presidio-analyzer - INFO - Loaded recognizer: EsNieRecognizer
Loaded recognizer: EsNieRecognizer
2025-10-21 13:57:01,625 - presidio-analyzer - INFO - Loaded recognizer: ItDriverLicenseRecognizer
Loaded recognizer: ItDriverLicenseRecognizer
2025-10-21 13:57:01,626 - presidio-analyzer - INFO - Loaded recognizer: ItFiscalCodeRecognizer
Loaded recognizer: ItFiscalCodeRecognizer
2025-10-21 13:57:01,626 - presidio-analyzer - INFO - Loaded recognizer: ItVatCodeRecognizer
Loaded recognizer: ItVatCodeRecognizer
2025-10-21 13:57:01,626 - presidio-analyzer - INFO - Loaded recognizer: ItIdentityCardRecognizer
Loaded recognizer: ItIdentityCardRecognizer
2025-10-21 13:57:01,626 - presidio-analyzer - INFO - Loaded recognizer: ItPassportRecognizer
Loaded recognizer: ItPassportRecognizer
2025-10-21 13:57:01,626 - presidio-analyzer - INFO - Loaded recognizer: PlPeselRecognizer
Loaded recognizer: PlPeselRecognizer
2025-10-21 13:57:01,626 - presidio-analyzer - INFO - Loaded recognizer: CryptoRecognizer
Loaded recognizer: CryptoRecognizer
2025-10-21 13:57:01,628 - presidio-analyzer - INFO - Loaded recognizer: DateRecognizer
Loaded recognizer: DateRecognizer
2025-10-21 13:57:01,628 - presidio-analyzer - INFO - Loaded recognizer: EmailRecognizer
Loaded recognizer: EmailRecognizer
2025-10-21 13:57:01,628 - presidio-analyzer - INFO - Loaded recognizer: IbanRecognizer
Loaded recognizer: IbanRecognizer
2025-10-21 13:57:01,628 - presidio-analyzer - INFO - Loaded recognizer: IpRecognizer
Loaded recognizer: IpRecognizer
2025-10-21 13:57:01,628 - presidio-analyzer - INFO - Loaded recognizer: MedicalLicenseRecognizer
Loaded recognizer: MedicalLicenseRecognizer
2025-10-21 13:57:01,628 - presidio-analyzer - INFO - Loaded recognizer: PhoneRecognizer
Loaded recognizer: PhoneRecognizer
2025-10-21 13:57:01,628 - presidio-analyzer - INFO - Loaded recognizer: UrlRecognizer
Loaded recognizer: UrlRecognizer
2025-10-21 13:57:01,628 - presidio-analyzer - INFO - Loaded recognizer: InVoterRecognizer
Loaded recognizer: InVoterRecognizer
2025-10-21 13:57:01,628 - presidio-analyzer - WARNING - Recognizer not added to registry because language is not supported by registry - CreditCardRecognizer supported languages: es, registry supported languages: en
Recognizer not added to registry because language is not supported by registry - CreditCardRecognizer supported languages: es, registry supported languages: en
2025-10-21 13:57:01,628 - presidio-analyzer - WARNING - Recognizer not added to registry because language is not supported by registry - CreditCardRecognizer supported languages: it, registry supported languages: en
Recognizer not added to registry because language is not supported by registry - CreditCardRecognizer supported languages: it, registry supported languages: en
2025-10-21 13:57:01,628 - presidio-analyzer - WARNING - Recognizer not added to registry because language is not supported by registry - CreditCardRecognizer supported languages: pl, registry supported languages: en
Recognizer not added to registry because language is not supported by registry - CreditCardRecognizer supported languages: pl, registry supported languages: en
2025-10-21 13:57:01,628 - presidio-analyzer - WARNING - Recognizer not added to registry because language is not supported by registry - EsNifRecognizer supported languages: es, registry supported languages: en
Recognizer not added to registry because language is not supported by registry - EsNifRecognizer supported languages: es, registry supported languages: en
2025-10-21 13:57:01,631 - presidio-analyzer - WARNING - Recognizer not added to registry because language is not supported by registry - EsNieRecognizer supported languages: es, registry supported languages: en
Recognizer not added to registry because language is not supported by registry - EsNieRecognizer supported languages: es, registry supported languages: en
2025-10-21 13:57:01,631 - presidio-analyzer - WARNING - Recognizer not added to registry because language is not supported by registry - ItDriverLicenseRecognizer supported languages: it, registry supported languages: en
Recognizer not added to registry because language is not supported by registry - ItDriverLicenseRecognizer supported languages: it, registry supported languages: en
2025-10-21 13:57:01,631 - presidio-analyzer - WARNING - Recognizer not added to registry because language is not supported by registry - ItFiscalCodeRecognizer supported languages: it, registry supported languages: en
Recognizer not added to registry because language is not supported by registry - ItFiscalCodeRecognizer supported languages: it, registry supported languages: en
2025-10-21 13:57:01,631 - presidio-analyzer - WARNING - Recognizer not added to registry because language is not supported by registry - ItVatCodeRecognizer supported languages: it, registry supported languages: en
Recognizer not added to registry because language is not supported by registry - ItVatCodeRecognizer supported languages: it, registry supported languages: en
2025-10-21 13:57:01,632 - presidio-analyzer - WARNING - Recognizer not added to registry because language is not supported by registry - ItIdentityCardRecognizer supported languages: it, registry supported languages: en
Recognizer not added to registry because language is not supported by registry - ItIdentityCardRecognizer supported languages: it, registry supported languages: en
2025-10-21 13:57:01,633 - presidio-analyzer - WARNING - Recognizer not added to registry because language is not supported by registry - ItPassportRecognizer supported languages: it, registry supported languages: en
Recognizer not added to registry because language is not supported by registry - ItPassportRecognizer supported languages: it, registry supported languages: en
2025-10-21 13:57:01,633 - presidio-analyzer - WARNING - Recognizer not added to registry because language is not supported by registry - PlPeselRecognizer supported languages: pl, registry supported languages: en
Recognizer not added to registry because language is not supported by registry - PlPeselRecognizer supported languages: pl, registry supported languages: en
2025-10-21 13:57:01,633 - presidio-analyzer - INFO - Loaded recognizer: SpacyRecognizer
Loaded recognizer: SpacyRecognizer
2025-10-21 13:57:01,634 - src.core.unified_explanation_engine - INFO - Unified explanation engine initialized with caching=True
Unified explanation engine initialized with caching=True
2025-10-21 13:57:01,634 - src.core.compliance_analyzer - INFO - Loaded existing confidence calibrator
Loaded existing confidence calibrator
2025-10-21 13:57:01,634 - src.core.compliance_analyzer - INFO - ComplianceAnalyzer initialized with all services.
ComplianceAnalyzer initialized with all services.
2025-10-21 13:57:01,638 - src.api.dependencies - INFO - Application startup complete. Services are initialized.
Application startup complete. Services are initialized.
2025-10-21 13:57:01,638 - src.api.main - INFO - {"event": "Vector store initialization started in background", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:01.638443Z"}
{"event": "Vector store initialization started in background", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:01.638443Z"}
2025-10-21 13:57:01,638 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-10-21 13:57:01,638 - apscheduler.scheduler - INFO - Added job "run_maintenance_jobs" to job store "default"
Added job "run_maintenance_jobs" to job store "default"
2025-10-21 13:57:01,638 - apscheduler.scheduler - INFO - Scheduler started
Scheduler started
2025-10-21 13:57:01,642 - src.api.main - INFO - {"event": "Scheduler started for daily maintenance tasks.", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:01.642307Z"}
{"event": "Scheduler started for daily maintenance tasks.", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:01.642307Z"}
2025-10-21 13:57:01,642 - src.api.main - INFO - {"event": "Starting in-memory task purge service.", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:01.642307Z"}
{"event": "Starting in-memory task purge service.", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:01.642307Z"}
2025-10-21 13:57:01,642 - src.api.main - INFO - {"event": "Cleanup services started in background", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:01.642307Z"}
{"event": "Cleanup services started in background", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:01.642307Z"}
2025-10-21 13:57:01,642 - src.api.main - INFO - {"event": "Request tracking initialized", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:01.642307Z"}
{"event": "Request tracking initialized", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:01.642307Z"}
2025-10-21 13:57:01,642 - src.api.main - INFO - {"event": "Error handling initialized", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:01.642307Z"}
{"event": "Error handling initialized", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:01.642307Z"}
2025-10-21 13:57:01,642 - src.api.main - INFO - {"event": "Enhanced worker manager and task registry cleanup started in background", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:01.642307Z"}
{"event": "Enhanced worker manager and task registry cleanup started in background", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:01.642307Z"}
2025-10-21 13:57:01,642 - src.core.service_manager - INFO - {"service": "api", "port": 8001, "event": "Registered service", "logger": "src.core.service_manager", "level": "info", "timestamp": "2025-10-21T20:57:01.642307Z"}
{"service": "api", "port": 8001, "event": "Registered service", "logger": "src.core.service_manager", "level": "info", "timestamp": "2025-10-21T20:57:01.642307Z"}
2025-10-21 13:57:01,642 - src.core.service_manager - INFO - {"service": "frontend", "port": 3001, "event": "Registered service", "logger": "src.core.service_manager", "level": "info", "timestamp": "2025-10-21T20:57:01.642307Z"}
{"service": "frontend", "port": 3001, "event": "Registered service", "logger": "src.core.service_manager", "level": "info", "timestamp": "2025-10-21T20:57:01.642307Z"}
2025-10-21 13:57:01,642 - src.api.main - INFO - {"event": "Service manager initialized", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:01.642307Z"}
{"event": "Service manager initialized", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:01.642307Z"}
2025-10-21 13:57:01,642 - src.core.vector_store - INFO - FAISS index initialized with embedding dimension: 768
FAISS index initialized with embedding dimension: 768
2025-10-21 13:57:01,642 - src.api.main - INFO - {"event": "Populating vector store with existing report embeddings...", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:01.642307Z"}
{"event": "Populating vector store with existing report embeddings...", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:01.642307Z"}
2025-10-21 13:57:01,748 - src.core.performance_metrics_collector - WARNING - High memory usage detected: 2203.20MB
High memory usage detected: 2203.20MB
2025-10-21 13:57:01,749 - src.core.file_cleanup_service - INFO - Starting file cleanup service...
Starting file cleanup service...
2025-10-21 13:57:01,749 - src.core.document_cleanup_service - INFO - Document cleanup service started (interval: 1h, max_age: 24h)
Document cleanup service started (interval: 1h, max_age: 24h)
2025-10-21 13:57:01,749 - src.core.cleanup_services - INFO - Registered cleanup service: document
Registered cleanup service: document
2025-10-21 13:57:01,749 - src.core.cleanup_services - INFO - Registered cleanup service: session
Registered cleanup service: session
2025-10-21 13:57:01,749 - src.core.cleanup_services - INFO - Registered cleanup service: log
Registered cleanup service: log
2025-10-21 13:57:01,749 - src.core.cleanup_services - INFO - Registered cleanup service: database
Registered cleanup service: database
2025-10-21 13:57:01,749 - src.core.cleanup_services - INFO - Registered cleanup service: system
Registered cleanup service: system
2025-10-21 13:57:01,749 - src.core.cleanup_services - INFO - document cleanup service started
document cleanup service started
2025-10-21 13:57:01,752 - src.core.cleanup_services - INFO - session cleanup service started
session cleanup service started
2025-10-21 13:57:01,752 - src.core.cleanup_services - INFO - log cleanup service started
log cleanup service started
2025-10-21 13:57:01,752 - src.core.cleanup_services - INFO - database cleanup service started
database cleanup service started
2025-10-21 13:57:01,752 - src.core.cleanup_services - INFO - system cleanup service started
system cleanup service started
2025-10-21 13:57:01,752 - src.core.cleanup_services - INFO - All cleanup services started
All cleanup services started
2025-10-21 13:57:01,752 - src.core.enhanced_worker_manager - INFO - {"event": "Worker manager started", "logger": "src.core.enhanced_worker_manager", "level": "info", "timestamp": "2025-10-21T20:57:01.752323Z"}
{"event": "Worker manager started", "logger": "src.core.enhanced_worker_manager", "level": "info", "timestamp": "2025-10-21T20:57:01.752323Z"}
2025-10-21 13:57:01,752 - src.core.document_cleanup_service - INFO - Starting document cleanup
Starting document cleanup
2025-10-21 13:57:01,755 - src.core.cleanup_services - INFO - Starting document cleanup
Starting document cleanup
2025-10-21 13:57:01,757 - src.core.cleanup_services - INFO - Starting session cleanup
Starting session cleanup
2025-10-21 13:57:01,757 - src.core.cleanup_services - INFO - Starting log cleanup
Starting log cleanup
2025-10-21 13:57:01,759 - src.core.cleanup_services - INFO - Log cleanup completed: 0 files cleaned
Log cleanup completed: 0 files cleaned
2025-10-21 13:57:01,759 - src.core.cleanup_services - INFO - Starting database cleanup
Starting database cleanup
2025-10-21 13:57:01,759 - src.core.cleanup_services - INFO - Database cleanup completed
Database cleanup completed
2025-10-21 13:57:01,759 - src.core.cleanup_services - INFO - Starting system resource cleanup
Starting system resource cleanup
2025-10-21 13:57:01,789 - src.core.cleanup_services - INFO - System resource cleanup completed: 0 items cleaned
System resource cleanup completed: 0 items cleaned
2025-10-21 13:57:01,789 - src.core.enhanced_worker_manager - INFO - {"event": "Worker loop started", "logger": "src.core.enhanced_worker_manager", "level": "info", "timestamp": "2025-10-21T20:57:01.789627Z"}
{"event": "Worker loop started", "logger": "src.core.enhanced_worker_manager", "level": "info", "timestamp": "2025-10-21T20:57:01.789627Z"}
2025-10-21 13:57:01,789 - src.core.document_cleanup_service - INFO - Expired documents cleaned up
Expired documents cleaned up
2025-10-21 13:57:01,797 - src.core.document_cleanup_service - INFO - Cleanup completed: 0 expired docs, 0 temp files, 0 log files
Cleanup completed: 0 expired docs, 0 temp files, 0 log files
2025-10-21 13:57:01,797 - src.core.cleanup_services - INFO - Document cleanup completed: 0 files cleaned
Document cleanup completed: 0 files cleaned
2025-10-21 13:57:01,797 - src.core.cleanup_services - INFO - Session cleanup completed: 0 sessions cleaned
Session cleanup completed: 0 sessions cleaned
2025-10-21 13:57:01,797 - src.api.middleware.request_tracking - INFO - Request started: POST /auth/register
Request started: POST /auth/register
2025-10-21 13:57:01,797 - requests - INFO - Request: POST /auth/register
Request: POST /auth/register
2025-10-21 13:57:01,805 - src.api.middleware.request_logging - INFO - Request started | id=a9e1c2a9-72c4-4381-a3b3-be674459394c | method=POST | url=/auth/register | client_ip=testclient | user_agent=testclient
Request started | id=a9e1c2a9-72c4-4381-a3b3-be674459394c | method=POST | url=/auth/register | client_ip=testclient | user_agent=testclient
2025-10-21 13:57:01,814 - src.api.main - INFO - {"event": "No existing reports with embeddings found to populate vector store.", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:01.814522Z"}
{"event": "No existing reports with embeddings found to populate vector store.", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:01.814522Z"}
2025-10-21 13:57:02,020 - src.database.crud - INFO - Created user: test_therapist
Created user: test_therapist
2025-10-21 13:57:02,020 - src.api.routers.auth - INFO - User registered successfully: test_therapist
User registered successfully: test_therapist
2025-10-21 13:57:02,020 - src.api.middleware.request_logging - INFO - Request completed | id=a9e1c2a9-72c4-4381-a3b3-be674459394c | method=POST | url=/auth/register | status=201 | time=0.215s | size=282
Request completed | id=a9e1c2a9-72c4-4381-a3b3-be674459394c | method=POST | url=/auth/register | status=201 | time=0.215s | size=282
2025-10-21 13:57:02,026 - requests - INFO - Response: POST /auth/register -> 201
Response: POST /auth/register -> 201
2025-10-21 13:57:02,027 - src.api.middleware.request_tracking - INFO - Request completed: POST /auth/register - 201
Request completed: POST /auth/register - 201
2025-10-21 13:57:02,028 - src.api.middleware.request_tracking - INFO - Request started: POST /auth/token
Request started: POST /auth/token
2025-10-21 13:57:02,028 - requests - INFO - Request: POST /auth/token
Request: POST /auth/token
2025-10-21 13:57:02,028 - src.api.middleware.request_logging - INFO - Request started | id=6c3a33fc-84e4-4916-8ef7-b6345ad4c51e | method=POST | url=/auth/token | client_ip=testclient | user_agent=testclient
Request started | id=6c3a33fc-84e4-4916-8ef7-b6345ad4c51e | method=POST | url=/auth/token | client_ip=testclient | user_agent=testclient
2025-10-21 13:57:02,221 - src.core.enhanced_session_manager - INFO - Session created for user test_therapist (user_id=1, session_id=HLZIA0eaNKRTxvYsE326f7Lm_CeRGfbOoOLPVZ0I388, ip=testclient)
Session created for user test_therapist (user_id=1, session_id=HLZIA0eaNKRTxvYsE326f7Lm_CeRGfbOoOLPVZ0I388, ip=testclient)
2025-10-21 13:57:02,221 - src.api.routers.auth - INFO - User test_therapist logged in successfully
User test_therapist logged in successfully
2025-10-21 13:57:02,221 - src.api.middleware.request_logging - INFO - Request completed | id=6c3a33fc-84e4-4916-8ef7-b6345ad4c51e | method=POST | url=/auth/token | status=200 | time=0.193s | size=177
Request completed | id=6c3a33fc-84e4-4916-8ef7-b6345ad4c51e | method=POST | url=/auth/token | status=200 | time=0.193s | size=177
2025-10-21 13:57:02,229 - requests - INFO - Response: POST /auth/token -> 200
Response: POST /auth/token -> 200
2025-10-21 13:57:02,229 - src.api.middleware.request_tracking - INFO - Request completed: POST /auth/token - 200
Request completed: POST /auth/token - 200
Step 1: Uploading document...
2025-10-21 13:57:02,238 - src.api.middleware.request_tracking - INFO - Request started: POST /upload-document
Request started: POST /upload-document
2025-10-21 13:57:02,238 - requests - INFO - Request: POST /upload-document
Request: POST /upload-document
2025-10-21 13:57:02,238 - src.api.middleware.request_logging - INFO - Request started | id=531a972b-3e87-4a7b-8835-ca8cf8232b16 | method=POST | url=/upload-document | client_ip=testclient | user_agent=testclient
Request started | id=531a972b-3e87-4a7b-8835-ca8cf8232b16 | method=POST | url=/upload-document | client_ip=testclient | user_agent=testclient
2025-10-21 13:57:02,242 - src.core.file_encryption - INFO - Stored encrypted document 864e4c81-975d-445c-83b8-e07bfb1a27d0 for user 1
Stored encrypted document 864e4c81-975d-445c-83b8-e07bfb1a27d0 for user 1
2025-10-21 13:57:02,242 - src.api.routers.analysis - INFO - {"document_id": "864e4c81-975d-445c-83b8-e07bfb1a27d0", "filename": "test_progress_note.txt", "user_id": 1, "event": "Legacy upload stored securely", "correlation_id": "0e4e8720-3043-474f-98c6-95b31a0fd033", "logger": "src.api.routers.analysis", "level": "info", "timestamp": "2025-10-21T20:57:02.242029Z"}
{"document_id": "864e4c81-975d-445c-83b8-e07bfb1a27d0", "filename": "test_progress_note.txt", "user_id": 1, "event": "Legacy upload stored securely", "correlation_id": "0e4e8720-3043-474f-98c6-95b31a0fd033", "logger": "src.api.routers.analysis", "level": "info", "timestamp": "2025-10-21T20:57:02.242029Z"}
2025-10-21 13:57:02,242 - src.api.middleware.request_logging - INFO - Request completed | id=531a972b-3e87-4a7b-8835-ca8cf8232b16 | method=POST | url=/upload-document | status=200 | time=0.004s | size=109
Request completed | id=531a972b-3e87-4a7b-8835-ca8cf8232b16 | method=POST | url=/upload-document | status=200 | time=0.004s | size=109
2025-10-21 13:57:02,242 - requests - INFO - Response: POST /upload-document -> 200
Response: POST /upload-document -> 200
2025-10-21 13:57:02,245 - src.api.middleware.request_tracking - INFO - Request completed: POST /upload-document - 200
Request completed: POST /upload-document - 200
Step 2: Verifying document accessibility...
2025-10-21 13:57:02,246 - src.api.middleware.request_tracking - INFO - Request started: GET /documents/864e4c81-975d-445c-83b8-e07bfb1a27d0
Request started: GET /documents/864e4c81-975d-445c-83b8-e07bfb1a27d0
2025-10-21 13:57:02,246 - requests - INFO - Request: GET /documents/864e4c81-975d-445c-83b8-e07bfb1a27d0
Request: GET /documents/864e4c81-975d-445c-83b8-e07bfb1a27d0
2025-10-21 13:57:02,248 - src.api.middleware.request_logging - INFO - Request started | id=1912eea0-9d09-46ac-b985-6c74fe641d5a | method=GET | url=/documents/864e4c81-975d-445c-83b8-e07bfb1a27d0 | client_ip=testclient | user_agent=testclient
Request started | id=1912eea0-9d09-46ac-b985-6c74fe641d5a | method=GET | url=/documents/864e4c81-975d-445c-83b8-e07bfb1a27d0 | client_ip=testclient | user_agent=testclient
2025-10-21 13:57:02,248 - src.api.middleware.request_logging - INFO - Request completed | id=1912eea0-9d09-46ac-b985-6c74fe641d5a | method=GET | url=/documents/864e4c81-975d-445c-83b8-e07bfb1a27d0 | status=200 | time=0.000s | size=249
Request completed | id=1912eea0-9d09-46ac-b985-6c74fe641d5a | method=GET | url=/documents/864e4c81-975d-445c-83b8-e07bfb1a27d0 | status=200 | time=0.000s | size=249
2025-10-21 13:57:02,248 - requests - INFO - Response: GET /documents/864e4c81-975d-445c-83b8-e07bfb1a27d0 -> 200
Response: GET /documents/864e4c81-975d-445c-83b8-e07bfb1a27d0 -> 200
2025-10-21 13:57:02,248 - src.api.middleware.request_tracking - INFO - Request completed: GET /documents/864e4c81-975d-445c-83b8-e07bfb1a27d0 - 200
Request completed: GET /documents/864e4c81-975d-445c-83b8-e07bfb1a27d0 - 200
FAILED2025-10-21 13:57:02,414 - src.api.dependencies - INFO - Application shutting down...
Application shutting down...
2025-10-21 13:57:02,414 - apscheduler.scheduler - INFO - Scheduler has been shut down
Scheduler has been shut down
2025-10-21 13:57:02,414 - src.api.main - INFO - {"event": "Stopping in-memory task purge service.", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:02.414837Z"}
{"event": "Stopping in-memory task purge service.", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:02.414837Z"}
2025-10-21 13:57:02,414 - src.core.file_cleanup_service - INFO - File cleanup service stopped
File cleanup service stopped
2025-10-21 13:57:02,414 - src.core.document_cleanup_service - INFO - Document cleanup service stopped
Document cleanup service stopped
2025-10-21 13:57:02,414 - src.core.cleanup_services - INFO - document cleanup service stopped
document cleanup service stopped
2025-10-21 13:57:02,414 - src.core.cleanup_services - INFO - session cleanup service stopped
session cleanup service stopped
2025-10-21 13:57:02,414 - src.core.cleanup_services - INFO - log cleanup service stopped
log cleanup service stopped
2025-10-21 13:57:02,417 - src.core.cleanup_services - INFO - database cleanup service stopped
database cleanup service stopped
2025-10-21 13:57:02,417 - src.core.cleanup_services - INFO - system cleanup service stopped
system cleanup service stopped
2025-10-21 13:57:02,417 - src.core.cleanup_services - INFO - All cleanup services stopped
All cleanup services stopped
2025-10-21 13:57:02,417 - src.core.enhanced_worker_manager - INFO - {"event": "Worker manager stopped", "logger": "src.core.enhanced_worker_manager", "level": "info", "timestamp": "2025-10-21T20:57:02.417878Z"}
{"event": "Worker manager stopped", "logger": "src.core.enhanced_worker_manager", "level": "info", "timestamp": "2025-10-21T20:57:02.417878Z"}
2025-10-21 13:57:02,417 - src.api.main - INFO - {"event": "Enhanced worker manager stopped", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:02.417878Z"}
{"event": "Enhanced worker manager stopped", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:02.417878Z"}
2025-10-21 13:57:02,417 - src.core.persistent_task_registry - INFO - {"event": "Task registry closed", "logger": "src.core.persistent_task_registry", "level": "info", "timestamp": "2025-10-21T20:57:02.417878Z"}
{"event": "Task registry closed", "logger": "src.core.persistent_task_registry", "level": "info", "timestamp": "2025-10-21T20:57:02.417878Z"}
2025-10-21 13:57:02,417 - src.api.main - INFO - {"event": "Persistent task registry closed", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:02.417878Z"}
{"event": "Persistent task registry closed", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:02.417878Z"}


================================== FAILURES ===================================
________ TestDocumentAnalysisWorkflow.test_complete_analysis_workflow _________

self = <tests.e2e.test_document_analysis_workflow.TestDocumentAnalysisWorkflow object at 0x00000244B897DC50>
e2e_helper = <tests.e2e.conftest.E2ETestHelper object at 0x00000244FD74ACD0>
sample_document_file = WindowsPath('D:/Temps/e2e_test_uploads_jf78pkn5/test_progress_note.txt')
test_rubric_data = {'discipline': 'pt', 'name': 'PT Compliance Test Rubric', 'rules': [{'description': 'Progress note must include subjec..., {'description': 'Plan section must be documented', 'id': 'plan_documented', 'pattern': 'PLAN:', 'severity': 'high'}]}
e2e_test_config = {'api_base_url': 'http://testserver', 'max_retries': 3, 'performance_thresholds': {'api_response': 5, 'document_analys...20, 'pdf_export': 30}, 'test_data_dir': WindowsPath('C:/Users/kevin/Desktop/ElectroAnalyzer/tests/e2e/test_data'), ...}

    @pytest.mark.asyncio
    async def test_complete_analysis_workflow(
        self,
        e2e_helper: E2ETestHelper,
        sample_document_file: Path,
        test_rubric_data: dict[str, Any],
        e2e_test_config: dict[str, Any],
    ):
        """
        Test the complete document analysis workflow.
    
        Workflow Steps:
        1. Upload document
        2. Select rubric
        3. Start analysis
        4. Monitor progress
        5. Retrieve results
        6. Export report
        """
        # Step 1: Upload document
        print("Step 1: Uploading document...")
        upload_response = e2e_helper.upload_document(sample_document_file)
    
        assert "document_id" in upload_response
        assert upload_response["status"] == "success"
        document_id = upload_response["document_id"]
    
        # Step 2: Verify document is accessible
        print("Step 2: Verifying document accessibility...")
        doc_response = e2e_helper.client.get(f"/documents/{document_id}", headers=e2e_helper.headers)
        assert doc_response.status_code == 200
        doc_data = doc_response.json()
        assert doc_data["id"] == document_id
>       assert "content" in doc_data
E       AssertionError: assert 'content' in {'file_size': 874, 'filename': 'test_progress_note.txt', 'id': '864e4c81-975d-445c-83b8-e07bfb1a27d0', 'metadata': {'content_type': 'text/plain', 'original_filename': 'test_progress_note.txt', 'upload_type': 'legacy'}, ...}

tests\e2e\test_document_analysis_workflow.py:59: AssertionError
----------------------------- Captured log setup ------------------------------
INFO     src.api.middleware.performance_monitoring:performance_monitoring.py:39 Performance monitoring middleware initialized
INFO     logging_setup:logging_config.py:83 {"event": "Structured logging configured successfully.", "logger": "logging_setup", "level": "info", "timestamp": "2025-10-21T20:56:54.893188Z"}
INFO     src.database.database:database.py:162 Initializing database schema
INFO     src.database.database:database.py:180 Applying SQLite performance optimizations
INFO     src.database.database:database.py:201 Database initialization complete
INFO     src.api.dependencies:dependencies.py:58 Application starting up...
INFO     src.api.dependencies:dependencies.py:74 Initializing real AnalysisService.
INFO     src.api.dependencies:dependencies.py:47 Retriever instance not found, creating a new one.
INFO     sentence_transformers.SentenceTransformer:SentenceTransformer.py:219 Use pytorch device_name: cpu
INFO     sentence_transformers.SentenceTransformer:SentenceTransformer.py:227 Load pretrained SentenceTransformer: pritamdeka/S-PubMedBert-MS-MARCO
INFO     src.core.query_expander:query_expander.py:213 Initialized default medical vocabulary
INFO     src.api.dependencies:dependencies.py:52 New retriever instance created and initialized.
INFO     src.core.analysis_service:analysis_service.py:134 AnalysisService initialized with use_mocks=False
INFO     presidio-analyzer:analyzer_engine.py:62 nlp_engine not provided, creating default.
INFO     presidio-analyzer:nlp_engine_provider.py:101 Created NLP engine: spacy. Loaded models: ['en']
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: CreditCardRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: CreditCardRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: CreditCardRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: CreditCardRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: UsBankRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: UsLicenseRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: UsItinRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: UsPassportRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: UsSsnRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: NhsRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: SgFinRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: AuAbnRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: AuAcnRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: AuTfnRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: AuMedicareRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: InPanRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: InAadhaarRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: InVehicleRegistrationRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: InPassportRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: EsNifRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: EsNieRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: ItDriverLicenseRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: ItFiscalCodeRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: ItVatCodeRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: ItIdentityCardRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: ItPassportRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: PlPeselRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: CryptoRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: DateRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: EmailRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: IbanRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: IpRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: MedicalLicenseRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: PhoneRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: UrlRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: InVoterRecognizer
WARNING  presidio-analyzer:recognizers_loader_utils.py:119 Recognizer not added to registry because language is not supported by registry - CreditCardRecognizer supported languages: es, registry supported languages: en
WARNING  presidio-analyzer:recognizers_loader_utils.py:119 Recognizer not added to registry because language is not supported by registry - CreditCardRecognizer supported languages: it, registry supported languages: en
WARNING  presidio-analyzer:recognizers_loader_utils.py:119 Recognizer not added to registry because language is not supported by registry - CreditCardRecognizer supported languages: pl, registry supported languages: en
WARNING  presidio-analyzer:recognizers_loader_utils.py:119 Recognizer not added to registry because language is not supported by registry - EsNifRecognizer supported languages: es, registry supported languages: en
WARNING  presidio-analyzer:recognizers_loader_utils.py:119 Recognizer not added to registry because language is not supported by registry - EsNieRecognizer supported languages: es, registry supported languages: en
WARNING  presidio-analyzer:recognizers_loader_utils.py:119 Recognizer not added to registry because language is not supported by registry - ItDriverLicenseRecognizer supported languages: it, registry supported languages: en
WARNING  presidio-analyzer:recognizers_loader_utils.py:119 Recognizer not added to registry because language is not supported by registry - ItFiscalCodeRecognizer supported languages: it, registry supported languages: en
WARNING  presidio-analyzer:recognizers_loader_utils.py:119 Recognizer not added to registry because language is not supported by registry - ItVatCodeRecognizer supported languages: it, registry supported languages: en
WARNING  presidio-analyzer:recognizers_loader_utils.py:119 Recognizer not added to registry because language is not supported by registry - ItIdentityCardRecognizer supported languages: it, registry supported languages: en
WARNING  presidio-analyzer:recognizers_loader_utils.py:119 Recognizer not added to registry because language is not supported by registry - ItPassportRecognizer supported languages: it, registry supported languages: en
WARNING  presidio-analyzer:recognizers_loader_utils.py:119 Recognizer not added to registry because language is not supported by registry - PlPeselRecognizer supported languages: pl, registry supported languages: en
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: SpacyRecognizer
INFO     src.core.preprocessing_service:preprocessing_service.py:35 Successfully loaded custom medical dictionary from: src/resources/medical_dictionary.txt
INFO     src.core.unified_explanation_engine:unified_explanation_engine.py:214 Unified explanation engine initialized with caching=True
INFO     src.core.advanced_ensemble_optimizer:advanced_ensemble_optimizer.py:140 Advanced ensemble optimizer initialized with learning=True
INFO     src.core.human_feedback_system:human_feedback_system.py:143 Human feedback system initialized with learning=True
INFO     src.core.accuracy_hallucination_tracker:accuracy_hallucination_tracker.py:141 AccuracyHallucinationTracker initialized with tracking enabled: True
INFO     src.core.safe_accuracy_improvements:safe_accuracy_improvements.py:72 SafeAccuracyEnhancer initialized with 10 strategies
INFO     src.core.multi_tier_cache:multi_tier_cache.py:149 Multi-tier cache system initialized: L1=200MB, L2=False, L3=True, Policy=lru
INFO     src.core.clinical_education_engine:clinical_education_engine.py:169 Clinical education engine initialized with 5 learning objectives and 5 content items
INFO     src.core.analysis_service:analysis_service.py:178 7 Habits Framework initialized successfully
INFO     src.core.rag_database_integration:rag_database_integration.py:116 RAG database initialized successfully
INFO     src.core.analysis_service:analysis_service.py:193 RAG system initialized successfully
INFO     src.core.model_selection_utils:model_selection_utils.py:44 Selected generator profile cpu_tinyllama_clinical (system memory {mem_gb} GB)
WARNING  src.core.model_selection_utils:model_selection_utils.py:69 Configured generator_local_path does not exist: C:\Users\kevin\Desktop\ElectroAnalyzer\models\tinyllama-clinical
INFO     src.core.ner:ner.py:81 Loading clinical NER model: OpenMed/OpenMed-NER-PathologyDetect-PubMed-v2-109M
INFO     src.core.ner:ner.py:92 Successfully loaded clinical NER model: OpenMed/OpenMed-NER-PathologyDetect-PubMed-v2-109M
INFO     src.core.ner:ner.py:81 Loading clinical NER model: d4data/biomedical-ner-all
INFO     src.core.ner:ner.py:92 Successfully loaded clinical NER model: d4data/biomedical-ner-all
INFO     presidio-analyzer:analyzer_engine.py:62 nlp_engine not provided, creating default.
INFO     presidio-analyzer:nlp_engine_provider.py:101 Created NLP engine: spacy. Loaded models: ['en']
INFO     presidio-analyzer:analyzer_engine.py:77 registry not provided, creating default.
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: CreditCardRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: CreditCardRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: CreditCardRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: CreditCardRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: UsBankRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: UsLicenseRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: UsItinRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: UsPassportRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: UsSsnRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: NhsRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: SgFinRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: AuAbnRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: AuAcnRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: AuTfnRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: AuMedicareRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: InPanRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: InAadhaarRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: InVehicleRegistrationRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: InPassportRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: EsNifRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: EsNieRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: ItDriverLicenseRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: ItFiscalCodeRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: ItVatCodeRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: ItIdentityCardRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: ItPassportRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: PlPeselRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: CryptoRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: DateRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: EmailRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: IbanRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: IpRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: MedicalLicenseRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: PhoneRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: UrlRecognizer
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: InVoterRecognizer
WARNING  presidio-analyzer:recognizers_loader_utils.py:119 Recognizer not added to registry because language is not supported by registry - CreditCardRecognizer supported languages: es, registry supported languages: en
WARNING  presidio-analyzer:recognizers_loader_utils.py:119 Recognizer not added to registry because language is not supported by registry - CreditCardRecognizer supported languages: it, registry supported languages: en
WARNING  presidio-analyzer:recognizers_loader_utils.py:119 Recognizer not added to registry because language is not supported by registry - CreditCardRecognizer supported languages: pl, registry supported languages: en
WARNING  presidio-analyzer:recognizers_loader_utils.py:119 Recognizer not added to registry because language is not supported by registry - EsNifRecognizer supported languages: es, registry supported languages: en
WARNING  presidio-analyzer:recognizers_loader_utils.py:119 Recognizer not added to registry because language is not supported by registry - EsNieRecognizer supported languages: es, registry supported languages: en
WARNING  presidio-analyzer:recognizers_loader_utils.py:119 Recognizer not added to registry because language is not supported by registry - ItDriverLicenseRecognizer supported languages: it, registry supported languages: en
WARNING  presidio-analyzer:recognizers_loader_utils.py:119 Recognizer not added to registry because language is not supported by registry - ItFiscalCodeRecognizer supported languages: it, registry supported languages: en
WARNING  presidio-analyzer:recognizers_loader_utils.py:119 Recognizer not added to registry because language is not supported by registry - ItVatCodeRecognizer supported languages: it, registry supported languages: en
WARNING  presidio-analyzer:recognizers_loader_utils.py:119 Recognizer not added to registry because language is not supported by registry - ItIdentityCardRecognizer supported languages: it, registry supported languages: en
WARNING  presidio-analyzer:recognizers_loader_utils.py:119 Recognizer not added to registry because language is not supported by registry - ItPassportRecognizer supported languages: it, registry supported languages: en
WARNING  presidio-analyzer:recognizers_loader_utils.py:119 Recognizer not added to registry because language is not supported by registry - PlPeselRecognizer supported languages: pl, registry supported languages: en
INFO     presidio-analyzer:entity_recognizer.py:58 Loaded recognizer: SpacyRecognizer
INFO     src.core.unified_explanation_engine:unified_explanation_engine.py:214 Unified explanation engine initialized with caching=True
INFO     src.core.compliance_analyzer:compliance_analyzer.py:119 Loaded existing confidence calibrator
INFO     src.core.compliance_analyzer:compliance_analyzer.py:103 ComplianceAnalyzer initialized with all services.
INFO     src.api.dependencies:dependencies.py:80 Application startup complete. Services are initialized.
INFO     src.api.main:main.py:339 {"event": "Vector store initialization started in background", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:01.638443Z"}
INFO     apscheduler.scheduler:base.py:507 Adding job tentatively -- it will be properly scheduled when the scheduler starts
INFO     apscheduler.scheduler:base.py:1090 Added job "run_maintenance_jobs" to job store "default"
INFO     apscheduler.scheduler:base.py:214 Scheduler started
INFO     src.api.main:main.py:349 {"event": "Scheduler started for daily maintenance tasks.", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:01.642307Z"}
INFO     src.api.main:main.py:168 {"event": "Starting in-memory task purge service.", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:01.642307Z"}
INFO     src.api.main:main.py:359 {"event": "Cleanup services started in background", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:01.642307Z"}
INFO     src.api.main:main.py:363 {"event": "Request tracking initialized", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:01.642307Z"}
INFO     src.api.main:main.py:367 {"event": "Error handling initialized", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:01.642307Z"}
INFO     src.api.main:main.py:373 {"event": "Enhanced worker manager and task registry cleanup started in background", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:01.642307Z"}
INFO     src.core.service_manager:service_manager.py:192 {"service": "api", "port": 8001, "event": "Registered service", "logger": "src.core.service_manager", "level": "info", "timestamp": "2025-10-21T20:57:01.642307Z"}
INFO     src.core.service_manager:service_manager.py:192 {"service": "frontend", "port": 3001, "event": "Registered service", "logger": "src.core.service_manager", "level": "info", "timestamp": "2025-10-21T20:57:01.642307Z"}
INFO     src.api.main:main.py:377 {"event": "Service manager initialized", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:01.642307Z"}
INFO     src.core.vector_store:vector_store.py:68 FAISS index initialized with embedding dimension: 768
INFO     src.api.main:main.py:220 {"event": "Populating vector store with existing report embeddings...", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:01.642307Z"}
WARNING  src.core.performance_metrics_collector:performance_metrics_collector.py:174 High memory usage detected: 2203.20MB
INFO     src.core.file_cleanup_service:file_cleanup_service.py:40 Starting file cleanup service...
INFO     src.core.document_cleanup_service:document_cleanup_service.py:45 Document cleanup service started (interval: 1h, max_age: 24h)
INFO     src.core.cleanup_services:cleanup_services.py:335 Registered cleanup service: document
INFO     src.core.cleanup_services:cleanup_services.py:335 Registered cleanup service: session
INFO     src.core.cleanup_services:cleanup_services.py:335 Registered cleanup service: log
INFO     src.core.cleanup_services:cleanup_services.py:335 Registered cleanup service: database
INFO     src.core.cleanup_services:cleanup_services.py:335 Registered cleanup service: system
INFO     src.core.cleanup_services:cleanup_services.py:46 document cleanup service started
INFO     src.core.cleanup_services:cleanup_services.py:46 session cleanup service started
INFO     src.core.cleanup_services:cleanup_services.py:46 log cleanup service started
INFO     src.core.cleanup_services:cleanup_services.py:46 database cleanup service started
INFO     src.core.cleanup_services:cleanup_services.py:46 system cleanup service started
INFO     src.core.cleanup_services:cleanup_services.py:351 All cleanup services started
INFO     src.core.enhanced_worker_manager:enhanced_worker_manager.py:68 {"event": "Worker manager started", "logger": "src.core.enhanced_worker_manager", "level": "info", "timestamp": "2025-10-21T20:57:01.752323Z"}
INFO     src.core.document_cleanup_service:document_cleanup_service.py:80 Starting document cleanup
INFO     src.core.cleanup_services:cleanup_services.py:101 Starting document cleanup
INFO     src.core.cleanup_services:cleanup_services.py:161 Starting session cleanup
INFO     src.core.cleanup_services:cleanup_services.py:197 Starting log cleanup
INFO     src.core.cleanup_services:cleanup_services.py:215 Log cleanup completed: 0 files cleaned
INFO     src.core.cleanup_services:cleanup_services.py:251 Starting database cleanup
INFO     src.core.cleanup_services:cleanup_services.py:256 Database cleanup completed
INFO     src.core.cleanup_services:cleanup_services.py:272 Starting system resource cleanup
INFO     src.core.cleanup_services:cleanup_services.py:292 System resource cleanup completed: 0 items cleaned
INFO     src.core.enhanced_worker_manager:enhanced_worker_manager.py:249 {"event": "Worker loop started", "logger": "src.core.enhanced_worker_manager", "level": "info", "timestamp": "2025-10-21T20:57:01.789627Z"}
INFO     src.core.document_cleanup_service:document_cleanup_service.py:110 Expired documents cleaned up
INFO     src.core.document_cleanup_service:document_cleanup_service.py:91 Cleanup completed: 0 expired docs, 0 temp files, 0 log files
INFO     src.core.cleanup_services:cleanup_services.py:126 Document cleanup completed: 0 files cleaned
INFO     src.core.cleanup_services:cleanup_services.py:178 Session cleanup completed: 0 sessions cleaned
INFO     src.api.middleware.request_tracking:request_tracking.py:49 Request started: POST /auth/register
INFO     requests:enhanced_logging.py:85 Request: POST /auth/register
INFO     src.api.middleware.request_logging:request_logging.py:64 Request started | id=a9e1c2a9-72c4-4381-a3b3-be674459394c | method=POST | url=/auth/register | client_ip=testclient | user_agent=testclient
INFO     src.api.main:main.py:251 {"event": "No existing reports with embeddings found to populate vector store.", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:01.814522Z"}
INFO     src.database.crud:crud.py:98 Created user: test_therapist
INFO     src.api.routers.auth:auth.py:123 User registered successfully: test_therapist
INFO     src.api.middleware.request_logging:request_logging.py:108 Request completed | id=a9e1c2a9-72c4-4381-a3b3-be674459394c | method=POST | url=/auth/register | status=201 | time=0.215s | size=282
INFO     requests:enhanced_logging.py:107 Response: POST /auth/register -> 201
INFO     src.api.middleware.request_tracking:request_tracking.py:68 Request completed: POST /auth/register - 201
INFO     src.api.middleware.request_tracking:request_tracking.py:49 Request started: POST /auth/token
INFO     requests:enhanced_logging.py:85 Request: POST /auth/token
INFO     src.api.middleware.request_logging:request_logging.py:64 Request started | id=6c3a33fc-84e4-4916-8ef7-b6345ad4c51e | method=POST | url=/auth/token | client_ip=testclient | user_agent=testclient
INFO     src.core.enhanced_session_manager:enhanced_session_manager.py:100 Session created for user test_therapist (user_id=1, session_id=HLZIA0eaNKRTxvYsE326f7Lm_CeRGfbOoOLPVZ0I388, ip=testclient)
INFO     src.api.routers.auth:auth.py:75 User test_therapist logged in successfully
INFO     src.api.middleware.request_logging:request_logging.py:108 Request completed | id=6c3a33fc-84e4-4916-8ef7-b6345ad4c51e | method=POST | url=/auth/token | status=200 | time=0.193s | size=177
INFO     requests:enhanced_logging.py:107 Response: POST /auth/token -> 200
INFO     src.api.middleware.request_tracking:request_tracking.py:68 Request completed: POST /auth/token - 200
------------------------------ Captured log call ------------------------------
INFO     src.api.middleware.request_tracking:request_tracking.py:49 Request started: POST /upload-document
INFO     requests:enhanced_logging.py:85 Request: POST /upload-document
INFO     src.api.middleware.request_logging:request_logging.py:64 Request started | id=531a972b-3e87-4a7b-8835-ca8cf8232b16 | method=POST | url=/upload-document | client_ip=testclient | user_agent=testclient
INFO     src.core.file_encryption:file_encryption.py:226 Stored encrypted document 864e4c81-975d-445c-83b8-e07bfb1a27d0 for user 1
INFO     src.api.routers.analysis:analysis.py:315 {"document_id": "864e4c81-975d-445c-83b8-e07bfb1a27d0", "filename": "test_progress_note.txt", "user_id": 1, "event": "Legacy upload stored securely", "correlation_id": "0e4e8720-3043-474f-98c6-95b31a0fd033", "logger": "src.api.routers.analysis", "level": "info", "timestamp": "2025-10-21T20:57:02.242029Z"}
INFO     src.api.middleware.request_logging:request_logging.py:108 Request completed | id=531a972b-3e87-4a7b-8835-ca8cf8232b16 | method=POST | url=/upload-document | status=200 | time=0.004s | size=109
INFO     requests:enhanced_logging.py:107 Response: POST /upload-document -> 200
INFO     src.api.middleware.request_tracking:request_tracking.py:68 Request completed: POST /upload-document - 200
INFO     src.api.middleware.request_tracking:request_tracking.py:49 Request started: GET /documents/864e4c81-975d-445c-83b8-e07bfb1a27d0
INFO     requests:enhanced_logging.py:85 Request: GET /documents/864e4c81-975d-445c-83b8-e07bfb1a27d0
INFO     src.api.middleware.request_logging:request_logging.py:64 Request started | id=1912eea0-9d09-46ac-b985-6c74fe641d5a | method=GET | url=/documents/864e4c81-975d-445c-83b8-e07bfb1a27d0 | client_ip=testclient | user_agent=testclient
INFO     src.api.middleware.request_logging:request_logging.py:108 Request completed | id=1912eea0-9d09-46ac-b985-6c74fe641d5a | method=GET | url=/documents/864e4c81-975d-445c-83b8-e07bfb1a27d0 | status=200 | time=0.000s | size=249
INFO     requests:enhanced_logging.py:107 Response: GET /documents/864e4c81-975d-445c-83b8-e07bfb1a27d0 -> 200
INFO     src.api.middleware.request_tracking:request_tracking.py:68 Request completed: GET /documents/864e4c81-975d-445c-83b8-e07bfb1a27d0 - 200
---------------------------- Captured log teardown ----------------------------
INFO     src.api.dependencies:dependencies.py:98 Application shutting down...
INFO     apscheduler.scheduler:base.py:245 Scheduler has been shut down
INFO     src.api.main:main.py:172 {"event": "Stopping in-memory task purge service.", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:02.414837Z"}
INFO     src.core.file_cleanup_service:file_cleanup_service.py:57 File cleanup service stopped
INFO     src.core.document_cleanup_service:document_cleanup_service.py:62 Document cleanup service stopped
INFO     src.core.cleanup_services:cleanup_services.py:60 document cleanup service stopped
INFO     src.core.cleanup_services:cleanup_services.py:60 session cleanup service stopped
INFO     src.core.cleanup_services:cleanup_services.py:60 log cleanup service stopped
INFO     src.core.cleanup_services:cleanup_services.py:60 database cleanup service stopped
INFO     src.core.cleanup_services:cleanup_services.py:60 system cleanup service stopped
INFO     src.core.cleanup_services:cleanup_services.py:366 All cleanup services stopped
INFO     src.core.enhanced_worker_manager:enhanced_worker_manager.py:87 {"event": "Worker manager stopped", "logger": "src.core.enhanced_worker_manager", "level": "info", "timestamp": "2025-10-21T20:57:02.417878Z"}
INFO     src.api.main:main.py:404 {"event": "Enhanced worker manager stopped", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:02.417878Z"}
INFO     src.core.persistent_task_registry:persistent_task_registry.py:398 {"event": "Task registry closed", "logger": "src.core.persistent_task_registry", "level": "info", "timestamp": "2025-10-21T20:57:02.417878Z"}
INFO     src.api.main:main.py:410 {"event": "Persistent task registry closed", "logger": "src.api.main", "level": "info", "timestamp": "2025-10-21T20:57:02.417878Z"}
=========================== short test summary info ===========================
FAILED tests/e2e/test_document_analysis_workflow.py::TestDocumentAnalysisWorkflow::test_complete_analysis_workflow
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!
============================== 1 failed in 7.71s ==============================
