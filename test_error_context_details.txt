============================= test session starts =============================
platform win32 -- Python 3.11.9, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\kevin\Desktop\ElectroAnalyzer\venv_test\Scripts\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\kevin\Desktop\ElectroAnalyzer
configfile: pytest.ini
plugins: anyio-4.11.0, asyncio-0.25.0, cov-6.0.0, mock-3.14.0, xdist-3.6.0
asyncio: mode=Mode.AUTO, asyncio_default_fixture_loop_scope=None
collecting ... collected 20 items

tests/unit/test_enhanced_error_context.py::TestErrorContextManager::test_database_error_categorization PASSED [  5%]
tests/unit/test_enhanced_error_context.py::TestErrorContextManager::test_ai_model_error_categorization PASSED [ 10%]
tests/unit/test_enhanced_error_context.py::TestErrorContextManager::test_authentication_error_categorization PASSED [ 15%]
tests/unit/test_enhanced_error_context.py::TestErrorContextManager::test_validation_error_categorization PASSED [ 20%]
tests/unit/test_enhanced_error_context.py::TestErrorContextManager::test_critical_error_severity PASSED [ 25%]
tests/unit/test_enhanced_error_context.py::TestErrorContextManager::test_request_context_collection PASSED [ 30%]
tests/unit/test_enhanced_error_context.py::TestErrorContextManager::test_sensitive_headers_redaction PASSED [ 35%]
tests/unit/test_enhanced_error_context.py::TestErrorContextManager::test_error_suggestions_generation PASSED [ 40%]
tests/unit/test_enhanced_error_context.py::TestErrorContextManager::test_stack_trace_extraction PASSED [ 45%]
tests/unit/test_enhanced_error_context.py::TestErrorContextManager::test_error_id_generation PASSED [ 50%]
tests/unit/test_enhanced_error_context.py::TestErrorContextManager::test_user_friendly_message_generation PASSED [ 55%]
tests/unit/test_enhanced_error_context.py::TestErrorContextManager::test_error_logging PASSED [ 60%]
tests/unit/test_enhanced_error_context.py::TestErrorContextManager::test_critical_error_logging PASSED [ 65%]
tests/unit/test_enhanced_error_context.py::TestErrorContextManager::test_error_details_extraction PASSED [ 70%]
tests/unit/test_enhanced_error_context.py::TestErrorContextManager::test_unknown_error_categorization PASSED [ 75%]
tests/unit/test_enhanced_error_context.py::TestEnhancedExceptionHandler::test_http_exception_handling PASSED [ 80%]
tests/unit/test_enhanced_error_context.py::TestEnhancedExceptionHandler::test_generic_exception_handling FAILED [ 85%]
tests/unit/test_enhanced_error_context.py::TestEnhancedExceptionHandler::test_debug_mode_response FAILED [ 90%]
tests/unit/test_enhanced_error_context.py::TestEnhancedExceptionHandler::test_error_handler_exception_safety FAILED [ 95%]
tests/unit/test_enhanced_error_context.py::TestEnhancedExceptionHandler::test_request_context_in_error_response PASSED [100%]

================================== FAILURES ===================================
________ TestEnhancedExceptionHandler.test_generic_exception_handling _________
tests\unit\test_enhanced_error_context.py:234: in test_generic_exception_handling
    response = client.post("/test-exception")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv_test\Lib\site-packages\starlette\testclient.py:552: in post
    return super().post(
venv_test\Lib\site-packages\httpx\_client.py:1144: in post
    return self.request(
venv_test\Lib\site-packages\starlette\testclient.py:451: in request
    return super().request(
venv_test\Lib\site-packages\httpx\_client.py:825: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv_test\Lib\site-packages\httpx\_client.py:914: in send
    response = self._send_handling_auth(
venv_test\Lib\site-packages\httpx\_client.py:942: in _send_handling_auth
    response = self._send_handling_redirects(
venv_test\Lib\site-packages\httpx\_client.py:979: in _send_handling_redirects
    response = self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv_test\Lib\site-packages\httpx\_client.py:1014: in _send_single_request
    response = transport.handle_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv_test\Lib\site-packages\starlette\testclient.py:354: in handle_request
    raise exc
venv_test\Lib\site-packages\starlette\testclient.py:351: in handle_request
    portal.call(self.app, scope, receive, send)
venv_test\Lib\site-packages\anyio\from_thread.py:321: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\..\AppData\Local\Programs\Python\Python311\Lib\concurrent\futures\_base.py:456: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
..\..\AppData\Local\Programs\Python\Python311\Lib\concurrent\futures\_base.py:401: in __get_result
    raise self._exception
venv_test\Lib\site-packages\anyio\from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
venv_test\Lib\site-packages\fastapi\applications.py:1133: in __call__
    await super().__call__(scope, receive, send)
venv_test\Lib\site-packages\starlette\applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
venv_test\Lib\site-packages\starlette\middleware\errors.py:186: in __call__
    raise exc
venv_test\Lib\site-packages\starlette\middleware\errors.py:164: in __call__
    await self.app(scope, receive, _send)
venv_test\Lib\site-packages\starlette\middleware\exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
venv_test\Lib\site-packages\starlette\_exception_handler.py:53: in wrapped_app
    raise exc
venv_test\Lib\site-packages\starlette\_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
venv_test\Lib\site-packages\fastapi\middleware\asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
venv_test\Lib\site-packages\starlette\routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
venv_test\Lib\site-packages\starlette\routing.py:736: in app
    await route.handle(scope, receive, send)
venv_test\Lib\site-packages\starlette\routing.py:290: in handle
    await self.app(scope, receive, send)
venv_test\Lib\site-packages\fastapi\routing.py:123: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
venv_test\Lib\site-packages\starlette\_exception_handler.py:53: in wrapped_app
    raise exc
venv_test\Lib\site-packages\starlette\_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
venv_test\Lib\site-packages\fastapi\routing.py:109: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
venv_test\Lib\site-packages\fastapi\routing.py:387: in app
    raw_response = await run_endpoint_function(
venv_test\Lib\site-packages\fastapi\routing.py:288: in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests\unit\test_enhanced_error_context.py:209: in test_exception
    raise Exception("Unexpected error")
E   Exception: Unexpected error
---------------------------- Captured stdout call -----------------------------
2025-10-21 14:44:56,933 - src.api.enhanced_error_context - INFO - Low severity error: Unexpected error
------------------------------ Captured log call ------------------------------
INFO     src.api.enhanced_error_context:enhanced_error_context.py:315 Low severity error: Unexpected error
____________ TestEnhancedExceptionHandler.test_debug_mode_response ____________
tests\unit\test_enhanced_error_context.py:248: in test_debug_mode_response
    response = client.post("/test-exception")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv_test\Lib\site-packages\starlette\testclient.py:552: in post
    return super().post(
venv_test\Lib\site-packages\httpx\_client.py:1144: in post
    return self.request(
venv_test\Lib\site-packages\starlette\testclient.py:451: in request
    return super().request(
venv_test\Lib\site-packages\httpx\_client.py:825: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv_test\Lib\site-packages\httpx\_client.py:914: in send
    response = self._send_handling_auth(
venv_test\Lib\site-packages\httpx\_client.py:942: in _send_handling_auth
    response = self._send_handling_redirects(
venv_test\Lib\site-packages\httpx\_client.py:979: in _send_handling_redirects
    response = self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv_test\Lib\site-packages\httpx\_client.py:1014: in _send_single_request
    response = transport.handle_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv_test\Lib\site-packages\starlette\testclient.py:354: in handle_request
    raise exc
venv_test\Lib\site-packages\starlette\testclient.py:351: in handle_request
    portal.call(self.app, scope, receive, send)
venv_test\Lib\site-packages\anyio\from_thread.py:321: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\..\AppData\Local\Programs\Python\Python311\Lib\concurrent\futures\_base.py:456: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
..\..\AppData\Local\Programs\Python\Python311\Lib\concurrent\futures\_base.py:401: in __get_result
    raise self._exception
venv_test\Lib\site-packages\anyio\from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
venv_test\Lib\site-packages\fastapi\applications.py:1133: in __call__
    await super().__call__(scope, receive, send)
venv_test\Lib\site-packages\starlette\applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
venv_test\Lib\site-packages\starlette\middleware\errors.py:186: in __call__
    raise exc
venv_test\Lib\site-packages\starlette\middleware\errors.py:164: in __call__
    await self.app(scope, receive, _send)
venv_test\Lib\site-packages\starlette\middleware\exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
venv_test\Lib\site-packages\starlette\_exception_handler.py:53: in wrapped_app
    raise exc
venv_test\Lib\site-packages\starlette\_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
venv_test\Lib\site-packages\fastapi\middleware\asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
venv_test\Lib\site-packages\starlette\routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
venv_test\Lib\site-packages\starlette\routing.py:736: in app
    await route.handle(scope, receive, send)
venv_test\Lib\site-packages\starlette\routing.py:290: in handle
    await self.app(scope, receive, send)
venv_test\Lib\site-packages\fastapi\routing.py:123: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
venv_test\Lib\site-packages\starlette\_exception_handler.py:53: in wrapped_app
    raise exc
venv_test\Lib\site-packages\starlette\_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
venv_test\Lib\site-packages\fastapi\routing.py:109: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
venv_test\Lib\site-packages\fastapi\routing.py:387: in app
    raw_response = await run_endpoint_function(
venv_test\Lib\site-packages\fastapi\routing.py:288: in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests\unit\test_enhanced_error_context.py:209: in test_exception
    raise Exception("Unexpected error")
E   Exception: Unexpected error
---------------------------- Captured stdout call -----------------------------
2025-10-21 14:44:57,521 - src.api.enhanced_error_context - INFO - Low severity error: Unexpected error
------------------------------ Captured log call ------------------------------
INFO     src.api.enhanced_error_context:enhanced_error_context.py:315 Low severity error: Unexpected error
______ TestEnhancedExceptionHandler.test_error_handler_exception_safety _______
tests\unit\test_enhanced_error_context.py:261: in test_error_handler_exception_safety
    response = client.post("/test-exception")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv_test\Lib\site-packages\starlette\testclient.py:552: in post
    return super().post(
venv_test\Lib\site-packages\httpx\_client.py:1144: in post
    return self.request(
venv_test\Lib\site-packages\starlette\testclient.py:451: in request
    return super().request(
venv_test\Lib\site-packages\httpx\_client.py:825: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv_test\Lib\site-packages\httpx\_client.py:914: in send
    response = self._send_handling_auth(
venv_test\Lib\site-packages\httpx\_client.py:942: in _send_handling_auth
    response = self._send_handling_redirects(
venv_test\Lib\site-packages\httpx\_client.py:979: in _send_handling_redirects
    response = self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv_test\Lib\site-packages\httpx\_client.py:1014: in _send_single_request
    response = transport.handle_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv_test\Lib\site-packages\starlette\testclient.py:354: in handle_request
    raise exc
venv_test\Lib\site-packages\starlette\testclient.py:351: in handle_request
    portal.call(self.app, scope, receive, send)
venv_test\Lib\site-packages\anyio\from_thread.py:321: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\..\AppData\Local\Programs\Python\Python311\Lib\concurrent\futures\_base.py:456: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
..\..\AppData\Local\Programs\Python\Python311\Lib\concurrent\futures\_base.py:401: in __get_result
    raise self._exception
venv_test\Lib\site-packages\anyio\from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
venv_test\Lib\site-packages\fastapi\applications.py:1133: in __call__
    await super().__call__(scope, receive, send)
venv_test\Lib\site-packages\starlette\applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
venv_test\Lib\site-packages\starlette\middleware\errors.py:186: in __call__
    raise exc
venv_test\Lib\site-packages\starlette\middleware\errors.py:164: in __call__
    await self.app(scope, receive, _send)
venv_test\Lib\site-packages\starlette\middleware\exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
venv_test\Lib\site-packages\starlette\_exception_handler.py:53: in wrapped_app
    raise exc
venv_test\Lib\site-packages\starlette\_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
venv_test\Lib\site-packages\fastapi\middleware\asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
venv_test\Lib\site-packages\starlette\routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
venv_test\Lib\site-packages\starlette\routing.py:736: in app
    await route.handle(scope, receive, send)
venv_test\Lib\site-packages\starlette\routing.py:290: in handle
    await self.app(scope, receive, send)
venv_test\Lib\site-packages\fastapi\routing.py:123: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
venv_test\Lib\site-packages\starlette\_exception_handler.py:53: in wrapped_app
    raise exc
venv_test\Lib\site-packages\starlette\_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
venv_test\Lib\site-packages\fastapi\routing.py:109: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
venv_test\Lib\site-packages\fastapi\routing.py:387: in app
    raw_response = await run_endpoint_function(
venv_test\Lib\site-packages\fastapi\routing.py:288: in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests\unit\test_enhanced_error_context.py:209: in test_exception
    raise Exception("Unexpected error")
E   Exception: Unexpected error
---------------------------- Captured stdout call -----------------------------
2025-10-21 14:44:57,672 - src.api.enhanced_error_context - CRITICAL - Error handler failed: Handler error
------------------------------ Captured log call ------------------------------
CRITICAL src.api.enhanced_error_context:enhanced_error_context.py:366 Error handler failed: Handler error
=========================== short test summary info ===========================
FAILED tests/unit/test_enhanced_error_context.py::TestEnhancedExceptionHandler::test_generic_exception_handling
FAILED tests/unit/test_enhanced_error_context.py::TestEnhancedExceptionHandler::test_debug_mode_response
FAILED tests/unit/test_enhanced_error_context.py::TestEnhancedExceptionHandler::test_error_handler_exception_safety
======================== 3 failed, 17 passed in 0.98s =========================
